<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Release This page contains Avito specific details  We publish releases to Bintray.
Publishing a new release  Check current status of Infra Gradle plugins configuration compatibility with Avito.
If it is Failed you could release from previous Succeed commits or fix compatibility problems. Check current status of Nightly Avito integration build.
If it is Failed you could release from previous Succeed commits or fix problems. Checkout a release branch with a name equals to projectVersion."><meta property="og:title" content><meta property="og:description" content="Release This page contains Avito specific details  We publish releases to Bintray.
Publishing a new release  Check current status of Infra Gradle plugins configuration compatibility with Avito.
If it is Failed you could release from previous Succeed commits or fix compatibility problems. Check current status of Nightly Avito integration build.
If it is Failed you could release from previous Succeed commits or fix problems. Checkout a release branch with a name equals to projectVersion."><meta property="og:type" content="article"><meta property="og:url" content="https://avito-tech.github.io/avito-android/docs/release/"><title>Release | Avito Android</title><link rel=icon href=/avito-android/favicon.png type=image/x-icon><link rel=stylesheet href=/avito-android/book.min.63eb88daa545365405ecdbb21033286a325c60a36cfa6d22d21e7c3bc9286941.css integrity="sha256-Y+uI2qVFNlQF7NuyEDMoajJcYKNs+m0i0h58O8koaUE="><script defer src=/avito-android/en.search.min.d9e337e5dc38abc662c5cf809700f6780dbb7534e363f2dcc54816fe59bb388f.js integrity="sha256-2eM35dw4q8Zixc+AlwD2eA27dTTjY/LcxUgW/lm7OI8="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157613383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/avito-android><span>Avito Android</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://avito-tech.github.io/avito-android/>Introduction</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/tech_radar/techradar/>Tech radar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/knownissues/>Known Issues</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Contacts</a></li><li>Projects<ul><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildchecks/>Build checks</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildproperties/>Build properties</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildtrace/>Build trace</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Steps</a></li></ul></li><li>Contributing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/howtostart/>How to start</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/docs/>Documentation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codereview/>Code Review</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codestyle/>Code Style</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/featuretoggles/>Feature Toggles</a></li></ul></li><li>IDE<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Конфигурации</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/templates/>Шаблоны</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/speedup/>Speedup</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/benchmarking/>Бенчмарки</a></li></ul></li><li>Builds<ul><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildtypes/>Типы сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/dependencies/>Зависимости</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/minimization/>Минимизация</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/benchmarks/>Бенчмарки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/profiling/>Профилирование</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildmetrics/>Метрики</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/mirakle/>Mirakle</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/troubleshooting/>Troubleshooting</a></li></ul></li><li>Architecture<ul><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/dagger/>Dagger</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/modules/>Modules</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/analytics/>Аналитика</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>Statsd</a></li></ul></li><li>Testing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/test/run/>Запуск тестов</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/runner/>Test Runner</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/manual/>Ручное</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testmanagementsystem/>Test Management System</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testcaseincode/>Test case in code</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/unittesting/>Юнит тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>Скриншотные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testminimized/>Test minimized</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/reportviewer/>Report Viewer</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/troubleshootingui/>Troubleshooting</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/workmanager/>Work Manager Testing</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakyannotation/>Flaky annotation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakytests/>Нестабильные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/toast/>Toast</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/snackbar/>Snackbar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenchecks/>Screen checks</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/testframework/>Test framework</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/mocking/>Mocking</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/internals/>Internals</a></li></ul></li><li><a href=http://links.k.avito.ru/ff>Design System</a></li><li>Performance<ul><li><a href=https://avito-tech.github.io/avito-android/docs/performance/analytics/>Аналитика</a></li></ul></li><li>Checks<ul><li><a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a></li></ul></li><li>CI<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>Требования</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Gradle Plugin</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/customgradleplugins/>Custom Gradle Plugins</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/containers/>Containers</a></li></ul></li><li>CD<ul><li><a href=https://avito-tech.github.io/avito-android/docs/cd/release/>Релиз</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/artifacts/>Артефакты сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/qapps/>QApps</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/release/>Infra Release</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/infrastructure/>Infrastructure (Github project)</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/externallibrarychangeprocess/>Внешние библиотеки</a></li></ul><ul><li><a href=/avito-android/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/avito-android/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Release</strong>
<label for=toc-control><img src=/avito-android/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#publishing-a-new-release>Publishing a new release</a><ul><li><a href=#known-issues>Known issues</a><ul><li><a href=#failed-publishing-to-bintray>Failed publishing to Bintray</a></li><li><a href=#cant-find-an-artifact-in-an-internal-artifactory>Can&rsquo;t find an artifact in an internal Artifactory</a></li></ul></li></ul></li><li><a href=#local-integration-tests-against-avito>Local integration tests against Avito</a><ul><li><a href=#using-mavenlocal>Using <code>mavenLocal</code></a></li><li><a href=#using-compositebuild>Using <code>compositeBuild</code></a></li></ul></li><li><a href=#ci-integration-tests-against-avito>CI integration tests against Avito</a></li><li><a href=#ci-integration-configurations>CI integration configurations</a></li></ul></nav></aside></header><article class=markdown><h1 id=release>Release</h1><blockquote class="book-hint info">This page contains Avito specific details</blockquote><p>We publish releases to <a href=https://bintray.com/avito-tech/maven/avito-android>Bintray</a>.</p><h2 id=publishing-a-new-release>Publishing a new release</h2><ol><li>Check current status of <a href=http://links.k.avito.ru/80>Infra Gradle plugins configuration compatibility with Avito</a>.<br>If it is <code>Failed</code> you could release from previous <code>Succeed</code> commits or fix compatibility problems.</li><li>Check current status of <a href=http://links.k.avito.ru/gZ>Nightly Avito integration build</a>.<br>If it is <code>Failed</code> you could release from previous <code>Succeed</code> commits or fix problems.</li><li>Checkout a <code>release branch</code> with a name equals to <code>projectVersion</code>. For example, <code>2020.9</code>.<br>This branch must be persistent. It is used for automation.</li><li>Manually run <a href=http://links.k.avito.ru/ZA>Integration build</a> on the <code>release branch</code>.</li><li>Manually run <a href=http://links.k.avito.ru/releaseAvitoTools>Github publish configuration</a> on the <code>release branch</code>.</li><li>Make a PR to an internal avito repository with the new version of infrastructure.</li><li>Checkout a new branch and make a PR to github repository:<ul><li>Change <code>infraVersion</code> property in the <code>./gradle.properties</code> to the new version</li><li>Bump up a <code>projectVersion</code> property in the <code>./subprojects/gradle.properties</code> to the next version</li></ul></li><li>Create a new <a href=https://help.github.com/en/github/administering-a-repository/managing-releases-in-a-repository>release</a> against the release branch.<br>You can use a draft release to prepare a description in advance.</li></ol><h3 id=known-issues>Known issues</h3><h4 id=failed-publishing-to-bintray>Failed publishing to Bintray</h4><p>Uploading to Bintray is flaky. You can face different issues:</p><ul><li>NoHttpResponseException: api.bintray.com:443 failed to respond <a href=https://github.com/bintray/gradle-bintray-plugin/issues/325>#325</a></li><li>Could not upload to <a href=https://api.bintray.com/...:>https://api.bintray.com/...:</a> HTTP/1.1 405 Not Allowed nginx</li></ul><p>In this case artifacts can be uploaded partially, only pom for instance.<br>Try to upload it with overriding:</p><ol start=0><li>Enable <code>BintrayExtension.override</code> in a buildscript.</li><li>Upload problematic artifact:<br><code>./gradlew -p subprojects :&lt;module>:bintrayUpload --no-parallel --stacktrace</code></li></ol><h4 id=cant-find-an-artifact-in-an-internal-artifactory>Can&rsquo;t find an artifact in an internal Artifactory</h4><p>How it looks:</p><ul><li>Bintray has <a href=https://dl.bintray.com/avito/maven/com/avito/android/runner-shared/2020.16/>expected artifacts</a>: pom, jar/aar, sources.jar</li><li>Gradle can&rsquo;t find in Artifactory</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>&gt; Could not resolve all artifacts for configuration &#39;:classpath&#39;.
   &gt; Could not find com.avito.android:runner-shared:2020.16.
     Searched in the following locations:
       - file:/home/user/.m2/repository/com/avito/android/runner-shared/2020.16/runner-shared-2020.16.pom
       - http://&lt;artifactory&gt;/artifactory/bintray-avito-maven/com/avito/android/runner-shared/2020.16/runner-shared-2020.16.pom
</code></pre></div><p>Probable reason:</p><p>When you use a partially uploaded release, Artifactory might cache the wrong state.
It seems that Artifactory caches it for some time, but we don&rsquo;t know exactly and how to invalidate it.</p><p>Actions:</p><ul><li>Bump up a minor release version and make a new release.</li></ul><h2 id=local-integration-tests-against-avito>Local integration tests against Avito</h2><h3 id=using-mavenlocal>Using <code>mavenLocal</code></h3><ol><li>Run <code>./gradlew publishToMavenLocal -PprojectVersion=local -p subprojects</code> in github repository.</li><li>Run integration tests of your choice in avito with specified test version</li></ol><h3 id=using-compositebuild>Using <code>compositeBuild</code></h3><p>Run from Avito project directory</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./gradlew &lt;task&gt; -Pavito.useCompositeBuild<span style=color:#f92672>=</span>true -Pavito.compositeBuildPath<span style=color:#f92672>=</span>&lt;avito-android-infra/subprojects dir on your local machine&gt;
</code></pre></div><h2 id=ci-integration-tests-against-avito>CI integration tests against Avito</h2><ol><li>Choose configuration from <a href=#ci-integration-configurations>existed</a></li><li>Run build.<br>If you need to test unmerged code, select a custom build branch.<br>You will see branches from both repositories:</li></ol><p><img src=https://user-images.githubusercontent.com/1104540/75977180-e5dd4d80-5eec-11ea-80d3-2f9abd7efd36.png alt></p><ul><li>By default, build uses develop from github against develop from avito</li><li>If you pick a branch from avito, it will run against develop on github</li><li>If you pick a branch from github, it will run against develop on avito</li><li>To build both projects of special branch, they should have the same name</li></ul><p>If you want to run a real CI build against not published release,
you need to publish it manually as a temporary version to the internal Artifactory.</p><h2 id=ci-integration-configurations>CI integration configurations</h2><ul><li><a href=http://links.k.avito.ru/fastCheck>fast check configuration (internal)</a> - pull request&rsquo;s builds</li><li><a href=http://links.k.avito.ru/ZA>integration check</a> - currently, contains the biggest amount of integration checks</li><li><a href=http://links.k.avito.ru/gZ>nightly integration check</a> - the same as <code>integration check</code> but uses more Android emulators</li><li><a href=http://links.k.avito.ru/80>Gradle configuration compatibility check</a> - checks the configuration compatibility of our Gradle plugins with Avito repo</li></ul></article><footer class=book-footer><div class="flex justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=/avito-android/ class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=/avito-android/ru/ class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
Русский</a></li></ul></div><div><a class="flex align-center" href=https://github.com/avito-tech/avito-android/tree/develop/docs/content/docs/Release.md target=_blank rel=noopener><img src=/avito-android/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div><a class="flex justify-end" href=/avito-android/docs/contacts><span>Contact us</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#publishing-a-new-release>Publishing a new release</a><ul><li><a href=#known-issues>Known issues</a><ul><li><a href=#failed-publishing-to-bintray>Failed publishing to Bintray</a></li><li><a href=#cant-find-an-artifact-in-an-internal-artifactory>Can&rsquo;t find an artifact in an internal Artifactory</a></li></ul></li></ul></li><li><a href=#local-integration-tests-against-avito>Local integration tests against Avito</a><ul><li><a href=#using-mavenlocal>Using <code>mavenLocal</code></a></li><li><a href=#using-compositebuild>Using <code>compositeBuild</code></a></li></ul></li><li><a href=#ci-integration-tests-against-avito>CI integration tests against Avito</a></li><li><a href=#ci-integration-configurations>CI integration configurations</a></li></ul></nav></aside></main></body></html>