<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CI steps plugin Plugin wasn&rsquo;t tested outside Avito yet, so expect difficulties, or even blockers. However, if you interested, please contact us!  Plugin creates chains of tasks for CI, encapsulating it under single gradle task.
Getting started Apply the plugin in the app&rsquo;s build.gradle file:
plugins { id(&#34;com.avito.android.cd&#34;) } The plugin can be applied to a root project or any module.
In the settings.gradle:
pluginManagement { repositories { maven { name = &#34;Avito bintray&#34; url = &#34;https://dl."><meta property="og:title" content="CI steps plugin"><meta property="og:description" content="CI steps plugin Plugin wasn&rsquo;t tested outside Avito yet, so expect difficulties, or even blockers. However, if you interested, please contact us!  Plugin creates chains of tasks for CI, encapsulating it under single gradle task.
Getting started Apply the plugin in the app&rsquo;s build.gradle file:
plugins { id(&#34;com.avito.android.cd&#34;) } The plugin can be applied to a root project or any module.
In the settings.gradle:
pluginManagement { repositories { maven { name = &#34;Avito bintray&#34; url = &#34;https://dl."><meta property="og:type" content="article"><meta property="og:url" content="https://avito-tech.github.io/avito-android/docs/projects/cisteps/"><title>CI steps plugin | Avito Android</title><link rel=icon href=/avito-android/favicon.png type=image/x-icon><link rel=stylesheet href=/avito-android/book.min.63eb88daa545365405ecdbb21033286a325c60a36cfa6d22d21e7c3bc9286941.css integrity="sha256-Y+uI2qVFNlQF7NuyEDMoajJcYKNs+m0i0h58O8koaUE="><script defer src=/avito-android/en.search.min.d9e337e5dc38abc662c5cf809700f6780dbb7534e363f2dcc54816fe59bb388f.js integrity="sha256-2eM35dw4q8Zixc+AlwD2eA27dTTjY/LcxUgW/lm7OI8="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-157613383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/avito-android><span>Avito Android</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://avito-tech.github.io/avito-android/>Introduction</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/tech_radar/techradar/>Tech radar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/knownissues/>Known Issues</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contacts/>Contacts</a></li><li>Projects<ul><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildchecks/>Build checks</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildproperties/>Build properties</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/buildtrace/>Build trace</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Steps</a></li></ul></li><li>Contributing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/howtostart/>How to start</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/docs/>Documentation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codereview/>Code Review</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/codestyle/>Code Style</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/contributing/featuretoggles/>Feature Toggles</a></li></ul></li><li>IDE<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ide/configurations/>Конфигурации</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/templates/>Шаблоны</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/speedup/>Speedup</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ide/benchmarking/>Бенчмарки</a></li></ul></li><li>Builds<ul><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildtypes/>Типы сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/dependencies/>Зависимости</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/minimization/>Минимизация</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/benchmarks/>Бенчмарки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/profiling/>Профилирование</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/buildmetrics/>Метрики</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/mirakle/>Mirakle</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/assemble/troubleshooting/>Troubleshooting</a></li></ul></li><li>Architecture<ul><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/dagger/>Dagger</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/architecture/modules/>Modules</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/analytics/>Аналитика</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/analytics/statsd/>Statsd</a></li></ul></li><li>Testing<ul><li><a href=https://avito-tech.github.io/avito-android/docs/test/run/>Запуск тестов</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/runner/>Test Runner</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/manual/>Ручное</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testmanagementsystem/>Test Management System</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testcaseincode/>Test case in code</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/unittesting/>Юнит тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenshottesting/>Скриншотные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/testminimized/>Test minimized</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/reportviewer/>Report Viewer</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/troubleshootingui/>Troubleshooting</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/workmanager/>Work Manager Testing</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakyannotation/>Flaky annotation</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/flakytests/>Нестабильные тесты</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/toast/>Toast</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/snackbar/>Snackbar</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test/screenchecks/>Screen checks</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/testframework/>Test framework</a><ul><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/mocking/>Mocking</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/test_framework/internals/>Internals</a></li></ul></li><li><a href=http://links.k.avito.ru/ff>Design System</a></li><li>Performance<ul><li><a href=https://avito-tech.github.io/avito-android/docs/performance/analytics/>Аналитика</a></li></ul></li><li>Checks<ul><li><a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a></li></ul></li><li>CI<ul><li><a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>Требования</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/projects/cisteps/>CI Gradle Plugin</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/customgradleplugins/>Custom Gradle Plugins</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/ci/containers/>Containers</a></li></ul></li><li>CD<ul><li><a href=https://avito-tech.github.io/avito-android/docs/cd/release/>Релиз</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/artifacts/>Артефакты сборки</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/cd/qapps/>QApps</a></li></ul></li><li><a href=https://avito-tech.github.io/avito-android/docs/release/>Infra Release</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/infrastructure/>Infrastructure (Github project)</a></li><li><a href=https://avito-tech.github.io/avito-android/docs/externallibrarychangeprocess/>Внешние библиотеки</a></li></ul><ul><li><a href=/avito-android/posts/>Blog</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/avito-android/svg/menu.svg class=book-icon alt=Menu></label>
<strong>CI steps plugin</strong>
<label for=toc-control><img src=/avito-android/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#getting-started>Getting started</a></li><li><a href=#builds>Builds</a><ul><li><a href=#avito-example-chains>Avito example chains</a></li></ul></li><li><a href=#steps>Steps</a><ul><li><a href=#built-in-steps>Built-in steps</a><ul><li><a href=#ui-tests>UI tests</a></li><li><a href=#performance-tests>Performance tests</a></li><li><a href=#android-lint>Android lint</a></li><li><a href=#compile-ui-tests>Compile UI tests</a></li><li><a href=#unit-tests>Unit tests</a></li><li><a href=#upload-to-qapps>Upload to QApps</a></li><li><a href=#upload-to-artifactory>Upload to Artifactory</a></li><li><a href=#upload-to-prosector>Upload to Prosector</a></li><li><a href=#upload-build-results>Upload build results</a></li><li><a href=#deploy-to-google-play>Deploy to Google Play</a></li><li><a href=#configuration-checks>Configuration checks</a></li></ul></li><li><a href=#using-impact-analysis-in-step>Using impact analysis in step</a></li><li><a href=#suppressing-errors-in-step>Suppressing errors in step</a></li><li><a href=#collecting-artifacts>Collecting artifacts</a></li><li><a href=#writing-a-custom-step>Writing a custom step</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=ci-steps-plugin>CI steps plugin</h1><blockquote class="book-hint warning">Plugin wasn&rsquo;t tested outside Avito yet, so expect difficulties, or even blockers.
However, if you interested, please <a href=https://avito-tech.github.io/avito-android/docs/contacts/>contact us</a>!</blockquote><p>Plugin creates chains of tasks for CI, encapsulating it under single gradle task.</p><h2 id=getting-started>Getting started</h2><p>Apply the plugin in the app&rsquo;s <code>build.gradle</code> file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>plugins <span style=color:#f92672>{</span>
    id<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.cd&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The plugin can be applied to a root project or any module.</p><p>In the <code>settings.gradle</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>pluginManagement <span style=color:#f92672>{</span>
    repositories <span style=color:#f92672>{</span>
        maven <span style=color:#f92672>{</span>
            name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Avito bintray&#34;</span>
            url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://dl.bintray.com/avito/maven&#34;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    resolutionStrategy <span style=color:#f92672>{</span>
        eachPlugin <span style=color:#f92672>{</span>
            String pluginId <span style=color:#f92672>=</span> requested<span style=color:#f92672>.</span><span style=color:#a6e22e>id</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span>
            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pluginId<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>def</span> artifact <span style=color:#f92672>=</span> pluginId<span style=color:#f92672>.</span><span style=color:#a6e22e>replace</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android.&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>)</span>
                useModule<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;com.avito.android:$artifact:$avitoToolsVersion&#34;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><code>avitoToolsVersion</code> could be exact version, or property in project&rsquo;s <code>gradle.properties</code>.<br>The latest version could be found on project&rsquo;s <a href=https://github.com/avito-tech/avito-android/releases>release page</a>.</p><h2 id=builds>Builds</h2><p>First of all, name your chain:</p><div class=book-tabs><input type=radio class=hidden name=tabs-chain id=tabs-chain-0 checked>
<label for=tabs-chain-0>Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>builds {
    register(<span style=color:#e6db74>&#34;myChain&#34;</span>) {
 
       <span style=color:#75715e>//optional description for generated task
</span><span style=color:#75715e></span>       taskDescription.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;This chain does something useful&#34;</span>)
    }
}
</code></pre></div></div><input type=radio class=hidden name=tabs-chain id=tabs-chain-1>
<label for=tabs-chain-1>Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>builds <span style=color:#f92672>{</span>
    myChain <span style=color:#f92672>{</span>

       <span style=color:#75715e>//optional description for generated task
</span><span style=color:#75715e></span>       taskDescription<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;This chain does something useful&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=avito-example-chains>Avito example chains</h3><ul><li><code>localCheck</code> - compilation checks for local run</li><li><code>prCheck</code> - as fast as possible checks for Pull Request. It must conform <a href=https://avito-tech.github.io/avito-android/docs/ci/civalues/>CI agreement</a></li><li><code>fullCheck</code> - as full as possible checks to be run after merges, non-blocking, could be slow</li><li><code>release</code> - chain to release our app</li></ul><h2 id=steps>Steps</h2><p>Step is a declaration to run some logic. It works inside a chain:</p><div class=book-tabs><input type=radio class=hidden name=tabs-steps id=tabs-steps-0 checked>
<label for=tabs-steps-0>Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>build {
    register(<span style=color:#e6db74>&#34;prCheck&#34;</span>) { <span style=color:#75715e>// &lt;--- chain
</span><span style=color:#75715e></span>
        unitTests {} <span style=color:#75715e>// &lt;--- step
</span><span style=color:#75715e></span>        uiTests {}
        lint {}

        <span style=color:#75715e>//optional description for generated task
</span><span style=color:#75715e></span>        taskDescription.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;This chain does something useful&#34;</span>)
    }
}
</code></pre></div></div><input type=radio class=hidden name=tabs-steps id=tabs-steps-1>
<label for=tabs-steps-1>Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>build <span style=color:#f92672>{</span>
    fastCheck <span style=color:#f92672>{</span> <span style=color:#75715e>// &lt;--- chain
</span><span style=color:#75715e></span>
        unitTests <span style=color:#f92672>{}</span> <span style=color:#75715e>// &lt;--- step
</span><span style=color:#75715e></span>        uiTests <span style=color:#f92672>{}</span>
        lint <span style=color:#f92672>{}</span>

        <span style=color:#75715e>//optional description for generated task
</span><span style=color:#75715e></span>        taskDescription<span style=color:#f92672>.</span><span style=color:#a6e22e>set</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;This chain does something useful&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><p>Now when you invoke <code>./gradlew fastCheck</code> gradle will run unitTests, uiTests and lint of corresponding project</p><h3 id=built-in-steps>Built-in steps</h3><h4 id=ui-tests>UI tests</h4><p>Runs instrumentation tests.</p><div class=book-tabs><input type=radio class=hidden name="tabs-ui tests" id="tabs-ui tests-0" checked>
<label for="tabs-ui tests-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>uiTests {
  configurations(<span style=color:#e6db74>&#34;configurationName&#34;</span>) <span style=color:#75715e>// list of instrumentation configuration to depends on
</span><span style=color:#75715e></span>  sendStatistics = <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFailures = <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  useImpactAnalysis = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFlaky = <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default. [игнорирование падений FlakyTest](https://avito-tech.github.io/avito-android/docs/test/flakyannotation/).
</span><span style=color:#75715e></span>}
</code></pre></div></div><input type=radio class=hidden name="tabs-ui tests" id="tabs-ui tests-1">
<label for="tabs-ui tests-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>uiTests <span style=color:#f92672>{</span>
  configurations <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;configurationName&#34;</span><span style=color:#f92672>]</span> <span style=color:#75715e>// list of instrumentation configuration to depends on
</span><span style=color:#75715e></span>  sendStatistics <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  useImpactAnalysis <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e>// by default
</span><span style=color:#75715e></span>  suppressFlaky <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> <span style=color:#75715e>// by default. [игнорирование падений FlakyTest](https://avito-tech.github.io/avito-android/docs/test/flakyannotation/).
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=performance-tests>Performance tests</h4><p>Runs performance tests.</p><div class=book-tabs><input type=radio class=hidden name="tabs-performance tests" id="tabs-performance tests-0" checked>
<label for="tabs-performance tests-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>performanceTests {
  configuration(<span style=color:#e6db74>&#34;configuration name&#34;</span>) <span style=color:#75715e>// performance configuration from Instrumentation plugin
</span><span style=color:#75715e></span>  enabled = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// true by default
</span><span style=color:#75715e></span>}
</code></pre></div></div><input type=radio class=hidden name="tabs-performance tests" id="tabs-performance tests-1">
<label for="tabs-performance tests-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>performanceTests <span style=color:#f92672>{</span>
  configuration <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;configuration name&#34;</span> <span style=color:#75715e>// performance configuration from Instrumentation plugin
</span><span style=color:#75715e></span>  enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e>// true by default
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=android-lint>Android lint</h4><p>Run <a href=https://avito-tech.github.io/avito-android/docs/checks/androidlint/>Android lint</a> tasks.</p><div class=book-tabs><input type=radio class=hidden name=tabs-lint id=tabs-lint-0 checked>
<label for=tabs-lint-0>Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>lint {}
</code></pre></div></div><input type=radio class=hidden name=tabs-lint id=tabs-lint-1>
<label for=tabs-lint-1>Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>lint <span style=color:#f92672>{}</span>
</code></pre></div></div></div><h4 id=compile-ui-tests>Compile UI tests</h4><p>Compile instrumentation tests. It is helpful in local development.</p><div class=book-tabs><input type=radio class=hidden name="tabs-compile ui tests" id="tabs-compile ui tests-0" checked>
<label for="tabs-compile ui tests-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>compileUiTests {}
</code></pre></div></div><input type=radio class=hidden name="tabs-compile ui tests" id="tabs-compile ui tests-1">
<label for="tabs-compile ui tests-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>compileUiTests <span style=color:#f92672>{}</span>
</code></pre></div></div></div><h4 id=unit-tests>Unit tests</h4><p>Run unit tests.</p><div class=book-tabs><input type=radio class=hidden name="tabs-unit tests" id="tabs-unit tests-0" checked>
<label for="tabs-unit tests-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>unitTests {}
</code></pre></div></div><input type=radio class=hidden name="tabs-unit tests" id="tabs-unit tests-1">
<label for="tabs-unit tests-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>unitTests <span style=color:#f92672>{}</span>
</code></pre></div></div></div><h4 id=upload-to-qapps>Upload to QApps</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload <a href=#collecting-artifacts>artifacts</a> to QApps (internal system)</p><div class=book-tabs><input type=radio class=hidden name="tabs-upload to qapps" id="tabs-upload to qapps-0" checked>
<label for="tabs-upload to qapps-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>artifacts {
    apk(<span style=color:#e6db74>&#34;debugApk&#34;</span>, ...)
}
uploadToQapps {
    artifacts = setOf(<span style=color:#e6db74>&#34;debugApk&#34;</span>)
}
</code></pre></div></div><input type=radio class=hidden name="tabs-upload to qapps" id="tabs-upload to qapps-1">
<label for="tabs-upload to qapps-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>...)</span>
<span style=color:#f92672>}</span>
uploadToQapps <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=upload-to-artifactory>Upload to Artifactory</h4><p>Upload <a href=#collecting-artifacts>artifacts</a> to Artifactory.</p><div class=book-tabs><input type=radio class=hidden name="tabs-upload to artifactory" id="tabs-upload to artifactory-0" checked>
<label for="tabs-upload to artifactory-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>artifacts {
    file(<span style=color:#e6db74>&#34;myReport&#34;</span>, <span style=color:#e6db74>&#34;${project.buildDir}/reports/my_report.json&#34;</span>)
}
uploadToArtifactory {
    artifacts = setOf(<span style=color:#e6db74>&#34;myReport&#34;</span>)
}
</code></pre></div></div><input type=radio class=hidden name="tabs-upload to artifactory" id="tabs-upload to artifactory-1">
<label for="tabs-upload to artifactory-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;myReport&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/my_report.json&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
uploadToArtifactory <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;myReport&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=upload-to-prosector>Upload to Prosector</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload <a href=#collecting-artifacts>artifacts</a> to <a href=http://links.k.avito.ru/cfxrREPBQ>Prosector (internal)</a>.</p><div class=book-tabs><input type=radio class=hidden name="tabs-upload to prosector" id="tabs-upload to prosector-0" checked>
<label for="tabs-upload to prosector-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>artifacts {
    apk(<span style=color:#e6db74>&#34;debugApk&#34;</span>, ...)
}
uploadToProsector {
    artifacts = setOf(<span style=color:#e6db74>&#34;debugApk&#34;</span>)
}
</code></pre></div></div><input type=radio class=hidden name="tabs-upload to prosector" id="tabs-upload to prosector-1">
<label for="tabs-upload to prosector-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
    apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>...)</span>
<span style=color:#f92672>}</span>
uploadToProsector <span style=color:#f92672>{</span>
    artifacts <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;debugApk&#34;</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=upload-build-results>Upload build results</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Upload all build results to a deploy service.</p><div class=book-tabs><input type=radio class=hidden name="tabs-upload build result" id="tabs-upload build result-0" checked>
<label for="tabs-upload build result-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>uploadBuildResult {
    uiTestConfiguration = <span style=color:#e6db74>&#34;regression&#34;</span> <span style=color:#75715e>// instrumentation configuration
</span><span style=color:#75715e></span>}
</code></pre></div></div><input type=radio class=hidden name="tabs-upload build result" id="tabs-upload build result-1">
<label for="tabs-upload build result-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>uploadBuildResult <span style=color:#f92672>{</span>
    uiTestConfiguration <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regression&#34;</span> <span style=color:#75715e>// instrumentation configuration
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div></div></div><h4 id=deploy-to-google-play>Deploy to Google Play</h4><blockquote class="book-hint info">This step contains Avito specific details</blockquote><p>Deploy to Google play.</p><div class=book-tabs><input type=radio class=hidden name="tabs-deploy to google play" id="tabs-deploy to google play-0" checked>
<label for="tabs-deploy to google play-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>deploy {}
</code></pre></div></div><input type=radio class=hidden name="tabs-deploy to google play" id="tabs-deploy to google play-1">
<label for="tabs-deploy to google play-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>deploy <span style=color:#f92672>{}</span>
</code></pre></div></div></div><h4 id=configuration-checks>Configuration checks</h4><blockquote class="book-hint info">This check contains Avito specific details</blockquote><p>Checks a repository configuration. See <code>:build-script-test</code> for details.</p><div class=book-tabs><input type=radio class=hidden name="tabs-config checks" id="tabs-config checks-0" checked>
<label for="tabs-config checks-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>configuration {}
</code></pre></div></div><input type=radio class=hidden name="tabs-config checks" id="tabs-config checks-1">
<label for="tabs-config checks-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>configuration <span style=color:#f92672>{}</span>
</code></pre></div></div></div><h3 id=using-impact-analysis-in-step>Using impact analysis in step</h3><p>Step can use <a href=https://avito-tech.github.io/avito-android/docs/ci/impactanalysis/>Impact analysis</a>.
It is enabled by default.</p><div class=book-tabs><input type=radio class=hidden name="tabs-use impact analysis" id="tabs-use impact analysis-0" checked>
<label for="tabs-use impact analysis-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>fastCheck {
    uiTests {
    }
}
</code></pre></div></div><input type=radio class=hidden name="tabs-use impact analysis" id="tabs-use impact analysis-1">
<label for="tabs-use impact analysis-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>fastCheck <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=suppressing-errors-in-step>Suppressing errors in step</h3><p>In different scenarios steps could fail whole build, some can be configured not to.</p><div class=book-tabs><input type=radio class=hidden name="tabs-suppressing errors" id="tabs-suppressing errors-0" checked>
<label for="tabs-suppressing errors-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>fastCheck {
    uiTests { 
        suppressFailures = <span style=color:#66d9ef>false</span> 
    }
}

release {
    uiTests { 
        suppressFailures = <span style=color:#66d9ef>true</span> 
    }
}
</code></pre></div></div><input type=radio class=hidden name="tabs-suppressing errors" id="tabs-suppressing errors-1">
<label for="tabs-suppressing errors-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>fastCheck <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span> 
        suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span> 
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

release <span style=color:#f92672>{</span>
    uiTests <span style=color:#f92672>{</span> 
        suppressFailures <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> 
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><h3 id=collecting-artifacts>Collecting artifacts</h3><p>Artifacts that planned to be used(uploaded somewhere) must be registered:</p><div class=book-tabs><input type=radio class=hidden name="tabs-collecting artifacts" id="tabs-collecting artifacts-0" checked>
<label for="tabs-collecting artifacts-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>artifacts {
   file(<span style=color:#e6db74>&#34;lintReport&#34;</span>, <span style=color:#e6db74>&#34;${project.buildDir}/reports/lint-results-release.html&#34;</span>)
}
</code></pre></div></div><input type=radio class=hidden name="tabs-collecting artifacts" id="tabs-collecting artifacts-1">
<label for="tabs-collecting artifacts-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>artifacts <span style=color:#f92672>{</span>
   file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;lintReport&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/lint-results-release.html&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><p>There are different types of artifacts:</p><ul><li>apk - gets apk by buildType and checks packageName and signature</li><li>bundle - gets bundle by buildType and checks packageName and signature</li><li>mapping - gets r8 mapping by buildType and checks availability</li><li>file - gets any file by path and checks availability</li></ul><div class=book-tabs><input type=radio class=hidden name="tabs-different types of artifacts" id="tabs-different types of artifacts-0" checked>
<label for="tabs-different types of artifacts-0">Kotlin</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>import</span> com.avito.cd.BuildVariant.RELEASE

<span style=color:#66d9ef>val</span> releaseSha1 = <span style=color:#e6db74>&#34;my sha&#34;</span> <span style=color:#75715e>// it&#39;s public info, so safe to share
</span><span style=color:#75715e></span>
artifacts {
   apk(<span style=color:#e6db74>&#34;releaseApk&#34;</span>, RELEASE, <span style=color:#e6db74>&#34;com.avito.android&#34;</span>, <span style=color:#e6db74>&#34;${project.buildDir}/outputs/apk/release/avito.apk&#34;</span>) { signature = releaseSha1 }
   bundle(<span style=color:#e6db74>&#34;releaseBundle&#34;</span>, RELEASE, <span style=color:#e6db74>&#34;com.avito.android&#34;</span>, <span style=color:#e6db74>&#34;${project.buildDir}/outputs/bundle/release/avito.aab&#34;</span>) { signature = releaseSha1 }
   mapping(<span style=color:#e6db74>&#34;releaseMapping&#34;</span>, RELEASE, <span style=color:#e6db74>&#34;${project.buildDir}/outputs/mapping/release/mapping.txt&#34;</span>)
   file(<span style=color:#e6db74>&#34;featureTogglesJson&#34;</span>, <span style=color:#e6db74>&#34;${project.buildDir}/reports/feature_toggles.json&#34;</span>)
}
</code></pre></div></div><input type=radio class=hidden name="tabs-different types of artifacts" id="tabs-different types of artifacts-1">
<label for="tabs-different types of artifacts-1">Groovy</label><div class="book-tabs-content markdown-inner"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#66d9ef>def</span> releaseSha1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my sha&#34;</span> <span style=color:#75715e>// it&#39;s public info, so safe to share
</span><span style=color:#75715e></span>
artifacts <span style=color:#f92672>{</span>
   apk<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseApk&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/outputs/apk/release/avito.apk&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span> signature <span style=color:#f92672>=</span> releaseSha1 <span style=color:#f92672>}</span>
   bundle<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseBundle&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;com.avito.android&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/outputs/bundle/release/avito.aab&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span> signature <span style=color:#f92672>=</span> releaseSha1 <span style=color:#f92672>}</span>
   mapping<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;releaseMapping&#34;</span><span style=color:#f92672>,</span> RELEASE<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/outputs/mapping/release/mapping.txt&#34;</span><span style=color:#f92672>)</span>
   file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;featureTogglesJson&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;${project.buildDir}/reports/feature_toggles.json&#34;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div></div></div><p>The first argument is a key for upload steps.</p><h3 id=writing-a-custom-step>Writing a custom step</h3><p>Inherit from <code>BuildStep</code>, check available implementations as examples</p></article><footer class=book-footer><div class="flex justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=/avito-android/ class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=/avito-android/ru/ class=flex><img src=/avito-android/svg/translate.svg class=book-icon alt=Languages>
Русский</a></li></ul></div><div><a class="flex align-center" href=https://github.com/avito-tech/avito-android/tree/develop/docs/content/docs/projects/CiSteps.md target=_blank rel=noopener><img src=/avito-android/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div><div><a class="flex justify-end" href=/avito-android/docs/contacts><span>Contact us</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#getting-started>Getting started</a></li><li><a href=#builds>Builds</a><ul><li><a href=#avito-example-chains>Avito example chains</a></li></ul></li><li><a href=#steps>Steps</a><ul><li><a href=#built-in-steps>Built-in steps</a><ul><li><a href=#ui-tests>UI tests</a></li><li><a href=#performance-tests>Performance tests</a></li><li><a href=#android-lint>Android lint</a></li><li><a href=#compile-ui-tests>Compile UI tests</a></li><li><a href=#unit-tests>Unit tests</a></li><li><a href=#upload-to-qapps>Upload to QApps</a></li><li><a href=#upload-to-artifactory>Upload to Artifactory</a></li><li><a href=#upload-to-prosector>Upload to Prosector</a></li><li><a href=#upload-build-results>Upload build results</a></li><li><a href=#deploy-to-google-play>Deploy to Google Play</a></li><li><a href=#configuration-checks>Configuration checks</a></li></ul></li><li><a href=#using-impact-analysis-in-step>Using impact analysis in step</a></li><li><a href=#suppressing-errors-in-step>Suppressing errors in step</a></li><li><a href=#collecting-artifacts>Collecting artifacts</a></li><li><a href=#writing-a-custom-step>Writing a custom step</a></li></ul></li></ul></nav></aside></main></body></html>